module.exports = function read(dirPath, callback) {
    var os = require('os'),
        fs = require('fs')
    exec = require('child_process').exec,
        path = require('path'),

        runOnWindows = 'start "' + path.normalize(process.cwd() + '/viewer/STDUViewerApp.exe"'),
        runOnLinux = 'xdg-open',
        runOnOSx = 'open';

    dirPath = path.normalize(dirPath);

    var OSAppsTable = {
        'win32': runOnWindows,
        'win64': runOnWindows,
        'linux': runOnLinux,
        'linux2': runOnLinux,
        'darwin': runOnOSx
    };

    fs.readdir(dirPath, function (err, files) {
        files.map(function (file) {
            return path.join(dirPath, file);
        })
            .filter(function (file) {
                return fs.statSync(file).isFile() & path.basename(file) != 'book.info' & path.basename(file) != 'index.html';
            })
            .forEach(function (file) {
                readBook(file);
                console.log(file);
            });
    });

    function readBook(file) {
        exec(OSAppsTable[os.platform()] + ' "' + file + '"',
            function (error, stdout, stderr) {
                if (error !== null) {
                    console.log('exec error: ' + error);
                    callback(error);
                }
                else callback(null);
            });
    }
}